services:
  traefik:
    image: traefik:v3.3
    container_name: traefik
    restart: unless-stopped

    command:
      ##### ğŸ“œ LOGGING CONFIGURATION #####
      # ğŸ‡«ğŸ‡· Activation des logs d'accÃ¨s
      # ğŸ‡¬ğŸ‡§ Enable access logs
      - --accesslog=true
      - --accesslog.filepath=/letsencrypt/access.log

      ##### ğŸ–¥ï¸ DASHBOARD & PROVIDERS #####
      - --api.dashboard=true
      - --providers.docker=true
      - --providers.docker.exposedbydefault=false

      ##### ğŸŒ ENTRYPOINTS (HTTP/HTTPS) #####
      - --entrypoints.http.address=:80
      - --entrypoints.http.http.redirections.entrypoint.to=https
      - --entrypoints.http.http.redirections.entrypoint.scheme=https
      - --entryPoints.https.address=:443

      ##### ğŸ”’ LET'S ENCRYPT CONFIGURATION #####
      - --certificatesresolvers.letsencrypt.acme.tlschallenge=true
      # ğŸ‡«ğŸ‡· Remplacez "example@example.ltd" par votre email pour les notifications Let's Encrypt
      # ğŸ‡¬ğŸ‡§ Replace "example@example.ltd" with your email for Let's Encrypt notifications
      - --certificatesresolvers.letsencrypt.acme.email=example@example.ltd
      - --certificatesresolvers.letsencrypt.acme.storage=/letsencrypt/acme.json

    security_opt:
      - no-new-privileges:true

    networks:
      - traefik-net

    ports:
      - 80:80
      - 443:443

    environment:
      TRAEFIK_DASHBOARD_CREDENTIALS: ${TRAEFIK_DASHBOARD_CREDENTIALS}

    env_file: .env

    volumes:
      - ./letsencrypt:/letsencrypt
      - /var/run/docker.sock:/var/run/docker.sock:ro

    labels:
      ##### ğŸš€ TRAEFIK CONFIGURATION #####
      - traefik.enable=true
      # ğŸ‡«ğŸ‡· Remplacez "traefik.example.ltd" par votre domaine
      # ğŸ‡¬ğŸ‡§ Replace "traefik.example.ltd" with your domain
      - traefik.http.routers.traefik-secure.rule=Host(`traefik.example.ltd`)
      - traefik.http.routers.traefik-secure.entrypoints=https
      - traefik.http.routers.traefik-secure.service=api@internal
      - traefik.http.routers.traefik-secure.tls.certresolver=letsencrypt

      ##### ğŸ” SÃ‰CURISATION DU DASHBOARD #####
      # ğŸ‡«ğŸ‡· Activez cette ligne pour limiter l'accÃ¨s au dashboard Ã  certaines IPs
      # ğŸ‡¬ğŸ‡§ Activate this line to restrict dashboard access to certain IPs
      #- traefik.http.routers.traefik-secure.middlewares=traefik-ipwhitelist,traefik-auth

      # ğŸ‡«ğŸ‡· Ajoutez ici vos adresses IP pour limiter l'accÃ¨s (ex: VPN)
      # ğŸ‡¬ğŸ‡§ Add your IPs here to limit access (e.g., VPN)
      #- traefik.http.middlewares.traefik-ipwhitelist.ipwhitelist.sourcerange=YOURIP1,YOURIP2

      # ğŸ‡«ğŸ‡· Active l'authentification basique pour le dashboard
      # ğŸ‡¬ğŸ‡§ Enable basic authentication for the dashboard
      - traefik.http.routers.traefik-secure.middlewares=traefik-auth
      - traefik.http.middlewares.traefik-auth.basicauth.users=${TRAEFIK_DASHBOARD_CREDENTIALS}
      - traefik.http.routers.traefik-secure.tls=true
      
    # ğŸ‡«ğŸ‡· Remplacez selon vos exigences ou retirÃ© cette partie
    # ğŸ‡¬ğŸ‡§ Replace according to your requirements or remove this part
    deploy:
      resources:
        limits:
          memory: 512M
          cpus: "1.0"
        reservations:
          memory: 256M

networks:
  traefik-net:
    external: true
